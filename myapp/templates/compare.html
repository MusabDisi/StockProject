{% extends "base.html" %}
{% block content %}


<div class="chart">

	<canvas id="chart"></canvas>

</div>


<style>
	#progress {
		width: 100%;
	}

	.progressWrapper {
		width: 40px;
	}

	#chart {
		width: 100%;
		height: 400px;
	}
</style>

<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3"></script>
<script>

	const stocksRaw = "{{ stocks|escapejs }}";

	$(document).ready(function () {
		requestData(stocksRaw, '1M');
	});


	function requestData(stocksRaw, interval) {
		$.get("/api/multi_historic/" + stocksRaw + "/" + interval, function () {
		}).done(function (data) {
			reflectDataOnChart(data.data);
		}).fail(function () {
			console.log('err');
		});
	}

	function reflectDataOnChart(data) {
		var ctx = $('#chart')[0].getContext('2d');
		var chart = new Chart(ctx, {
			type: 'line',
			data: {
				labels: data[0].data.map(d => d.label),
				datasets: getDataSet(data)
			},
			options: {}
		});
	}

	function getDataSet(stocks) {
		list = [];
		for (stock of stocks) {
			color = getRandomColor();
			list.push({
				label: stock.name,
				borderColor: color + ')',
				backgroundColor: color + ', 0.4)',
				data: stock.data.map(d => d.low),
			});
		}

		return list;
	}

	function getRandomColor() {
		var r = Math.ceil(Math.random() * 255);
		var g = Math.ceil(Math.random() * 255);
		var b = Math.ceil(Math.random() * 255);
		return 'rgb(' + r + ',' + g + ',' + b;
	}

</script>

{% endblock %}
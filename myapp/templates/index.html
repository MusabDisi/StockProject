{% extends "base.html" %}

{% block content %}
    <!--
    <div class="row">
        <div class="col-11 text-left">Top Stocks</div>
        <div class="col-1 text-right">X</div>
    </div>
    -->
    <table class="table table-hover data-table">
        <tr>
            <th>#</th>
            <th>Symbol</th>
            <th>Name</th>
            <th>Price</th>
            <th>Change</th>
        </tr>
        {% for stock in data %}
            <tr class="clickable-row" data-href="/stock/{{ stock.symbol }}">

                <td>
                {% if   user.is_authenticated %}
                    {% if  stock.symbol in favorite_stocks  %}
                        <span id='{{stock.symbol}}' class="fa fa-star fav"></span>
                    {% else %}
                        <span id='{{stock.symbol}}' class="fa fa-star-o n-fav"></span>
                {% endif %}
                {% endif %}
                    {{ forloop.counter }}</td>

                <td>{{ stock.symbol }}</td>
                <td>{{ stock.name }}</td>
                <td>{{ stock.price|floatformat:2 }}</td>
                <td class="
                {% if stock.change_percent >= 0 %}
                    text-success
                {% else %}
                    text-danger
                {% endif %}
                ">{{ stock.change_percent|floatformat:2 }}%</td>

            </tr>
        {% endfor %}
    </table>
{% endblock %}

{% block scripts %}
<script>
    $(".fav, .n-fav").click(function (e) {
        e.preventDefault();
        var method = 'PUT'
        console.log($(this).hasClass('fav'))

        let elm = $(this)
        if (elm.hasClass('fav')) {
            method = 'DELETE'
        }
        $.ajax({
            url: '{% url 'edit_fav_stock' %}',
            headers: { "X-CSRFToken": '{{csrf_token}}' },
            method: method,
            data: {
                'symbol': e.target.id
            },
            dataType: 'json',
            success: function (data) {
                if (elm.hasClass('fav')) {
                    elm.removeClass('fa-star fav').addClass('n-fav fa-star-o');
                }
                else{
                    elm.addClass('fa-star fav').removeClass('n-fav fa-star-o');
                }

                }
        });
        e.stopPropagation();

    })
</script>
{% endblock scripts %}